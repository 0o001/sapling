# @autodeps

thrift_library(
    name = "serialization",
    languages = [
        "cpp2",
        "py",
        "rust",
    ],
    py_base_module = "facebook.eden",
    thrift_args = ["--strict"],
    thrift_srcs = {
        "overlay.thrift": [],
    },
    deps = [
        ":hgdirstate",
    ],
)

thrift_library(
    name = "hgdirstate",
    # Need to support .java and .py because eden.thrift depends on this file.
    languages = [
        "cpp2",
        "javadeprecated",
        "py",
        "rust",
    ],
    py_base_module = "facebook",
    thrift_args = ["--strict"],
    thrift_srcs = {
        "hgdirstate.thrift": None,
    },
)

cpp_library(
    name = "inodes",
    srcs = glob(["*.cpp"]),
    headers = glob(["*.h"]),
    deps = [
        ":hgdirstate-cpp2",
        ":serialization-cpp2",
        "@/eden/fs/config:config",
        "@/eden/fs/fuse:fusell",
        "@/eden/fs/fuse/privhelper:privhelper",
        "@/eden/fs/journal:journal",
        "@/eden/fs/model:model",
        "@/eden/fs/model/git:gitignore",
        "@/eden/fs/service:thrift-streaming-cpp2",
        "@/eden/fs/service:thrift_cpp",
        "@/eden/fs/store:store",
        "@/eden/fs/utils:path",
        "@/eden/fs/utils:utils",
        "@/folly:exception",
        "@/folly:exception_wrapper",
        "@/folly:fbstring",
        "@/folly:file",
        "@/folly:file_util",
        "@/folly:format",
        "@/folly:likely",
        "@/folly:map_util",
        "@/folly:optional",
        "@/folly:portability",
        "@/folly:range",
        "@/folly:shared_mutex",
        "@/folly:string",
        "@/folly:subprocess",
        "@/folly:synchronized",
        "@/folly:thread_local",
        "@/folly:unit",
        "@/folly/executors:cpu_thread_pool_executor",
        "@/folly/executors:global_executor",
        "@/folly/experimental:string_keyed_unordered_map",
        "@/folly/experimental/logging:logging",
        "@/folly/futures:core",
        "@/folly/io:iobuf",
        "@/folly/io/async:async",
        "@/folly/system:thread_name",
        "@/thrift/lib/cpp2/protocol:protocol",
    ],
    external_deps = [
        ("boost", None, "boost_filesystem"),
        "boost",
        "gflags",
        "glog",
        ("openssl", None, "crypto"),
    ],
)
